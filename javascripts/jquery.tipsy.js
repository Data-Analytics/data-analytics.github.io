(function(e){function t(e,t){return typeof e=="function"?e.call(t):e}function r(t,r){this.$element=e(t);this.options=r;this.enabled=true;this.fixTitle();n(this)}var n=function(){function r(){for(var e=0;e<n.length;){var t=n[e];if(t.options.gcInterval===0||t.$element.closest("body").length===0){t.hoverState="out";t.hide();n.splice(e,1)}else{e++}}}function i(){t=setTimeout(function(){r();i()},e)}var e;var t=null;var n=[];return function(r){if(r.options.gcInterval===0)return;if(t&&r.options.gcInterval<e){clearTimeout(t);t=null;e=r.options.gcInterval}n.push(r);if(!t)i()}}();r.prototype={show:function(){var n=this.getTitle();if(n&&this.enabled){var r=this.tip();r.find(".tipsy-inner")[this.options.html?"html":"text"](n);r[0].className="tipsy";r.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var i=e.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth||0,height:this.$element[0].offsetHeight||0});if(typeof this.$element[0].nearestViewportElement=="object"){var s=this.$element[0];var o=s.getBoundingClientRect();i.width=o.width;i.height=o.height}var u=r[0].offsetWidth,a=r[0].offsetHeight,f=t(this.options.gravity,this.$element[0]);var l;switch(f.charAt(0)){case"n":l={top:i.top+i.height+this.options.offset,left:i.left+i.width/2-u/2};break;case"s":l={top:i.top-a-this.options.offset,left:i.left+i.width/2-u/2};break;case"e":l={top:i.top+i.height/2-a/2,left:i.left-u-this.options.offset};break;case"w":l={top:i.top+i.height/2-a/2,left:i.left+i.width+this.options.offset};break}if(f.length==2){if(f.charAt(1)=="w"){l.left=i.left+i.width/2-15}else{l.left=i.left+i.width/2-u+15}}r.css(l).addClass("tipsy-"+f);r.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+f.charAt(0);if(this.options.className){r.addClass(t(this.options.className,this.$element[0]))}if(this.options.fade){r.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity})}else{r.css({visibility:"visible",opacity:this.options.opacity})}var c=this;var h=function(e){return function(){c.$tip.stop();c.tipHovered=e;if(!e){if(c.options.delayOut===0&&c.options.trigger!="manual"){c.hide()}else{setTimeout(function(){if(c.hoverState=="out")c.hide()},c.options.delayOut)}}}};r.hover(h(true),h(false))}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){e(this).remove()})}else{this.tip().remove()}},fixTitle:function(){var e=this.$element;if(e.attr("title")||typeof e.attr("original-title")!="string"){e.attr("original-title",e.attr("title")||"").removeAttr("title")}if(typeof e.context.nearestViewportElement=="object"){if(e.children("title").length){e.append("<original-title>"+(e.children("title").text()||"")+"</original-title>").children("title").remove()}}},getTitle:function(){var e,t=this.$element,n=this.options;this.fixTitle();if(typeof n.title=="string"){var r=n.title=="title"?"original-title":n.title;if(t.children(r).length){e=t.children(r).html()}else{e=t.attr(r);if(typeof e=="undefined")e=""}}else if(typeof n.title=="function"){e=n.title.call(t[0])}e=(""+e).replace(/(^\s*|\s*$)/,"");return e||n.fallback},tip:function(){if(!this.$tip){this.$tip=e('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>')}return this.$tip},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled}};e.fn.tipsy=function(t){function n(n){var i=e.data(n,"tipsy");if(!i){i=new r(n,e.fn.tipsy.elementOptions(n,t));e.data(n,"tipsy",i)}return i}function i(){var e=n(this);e.hoverState="in";if(t.delayIn===0){e.show()}else{e.fixTitle();setTimeout(function(){if(e.hoverState=="in")e.show()},t.delayIn)}}function s(){var e=n(this);e.hoverState="out";if(t.delayOut===0){e.hide()}else{var r=function(){if(!e.tipHovered||!t.hoverlock){if(e.hoverState=="out")e.hide()}};setTimeout(r,t.delayOut)}}if(t===true){return this.data("tipsy")}else if(typeof t=="string"){e(this).each(function(n,r){if(e(r).data("tipsy")){tipsy=e(r).data("tipsy");tipsy[t]()}});return this}t=e.extend({},e.fn.tipsy.defaults,t);if(t.hoverlock&&t.delayOut===0){t.delayOut=100}if(!t.live)this.each(function(){n(this)});if(t.trigger!="manual"){var o=t.live?"live":"bind",u=t.trigger=="hover"?"mouseenter":"focus",a=t.trigger=="hover"?"mouseleave":"blur";this[o](u,i)[o](a,s)}return this};e.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:false,fallback:"",gcInterval:0,gravity:"n",html:false,live:false,offset:0,opacity:.8,title:"title",trigger:"hover",hoverlock:false};e.fn.tipsy.elementOptions=function(t,n){return e.metadata?e.extend({},n,e(t).metadata()):n};e.fn.tipsy.autoNS=function(){return e(this).offset().top>e(document).scrollTop()+e(window).height()/2?"s":"n"};e.fn.tipsy.autoWE=function(){return e(this).offset().left>e(document).scrollLeft()+e(window).width()/2?"e":"w"};e.fn.tipsy.autoBounds=function(t,n){return function(){var r={ns:n[0],ew:n.length>1?n[1]:false},i=e(document).scrollTop()+t,s=e(document).scrollLeft()+t,o=e(this);if(o.offset().top<i)r.ns="n";if(o.offset().left<s)r.ew="w";if(e(window).width()+e(document).scrollLeft()-o.offset().left<t)r.ew="e";if(e(window).height()+e(document).scrollTop()-o.offset().top<t)r.ns="s";return r.ns+(r.ew?r.ew:"")}}})(jQuery)