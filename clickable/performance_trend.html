
	var sub_width = parseInt(d3.select('.party_performance_trend_svg').style('width'), 10)
		
	var margin = {top: 20, right: 20, bottom: 20, left: 20},
		width = sub_width - margin.left - margin.right,
		height = 460 - margin.top - margin.bottom;
	
    var party_performance_trend_svg = d3.select(".party_performance_trend_svg").append("svg")
		    .attr("width", "100%")
            .attr("data-height","0.54")
            .attr("viewBox","0 0 "+(width + margin.left + margin.right)+" "+(height + margin.top + margin.bottom))
			.attr("xmlns", 'http://www.w3.org/2000/svg')
			.attr("xlink", 'http://www.w3.org/1999/xlink')
			.attr("version", '1.1')
			.append("g")
			.attr("transform", "translate(" + (margin.left+(width/2))+ "," + (margin.top+(height/2)) + ")");
        
	contest_data_csv = data_csv.filter(function(d){return (d.year==year_detail)});
		
		var contest_data_count = d3.nest()
			  .key(function(d) { return d.PARTY; })
			  .rollup(function(v) { return v.length; })
			  .entries(contest_data_csv);
			  
	winning_data_csv = contest_data_csv.filter(function(d){return (d.rank==1)});  
	
		var winning_data_count = d3.nest()
			  .key(function(d) { return d.PARTY; })
			  .rollup(function(v) { return v.length; })
			  .entries(winning_data_csv);
			  
		 
		winning_data_count.forEach(function(o) {
		    o.weight = o.values
			o.width  = +o.weight;
			contest_data_count.forEach(function(d) {
				if(d.key==o.key){
					o.contest = d.values
				} 

			});
			o.score  = (o.values*100/o.contest).toFixed(2);			
		});
		
		
		radius = Math.min(width, height) / 2,
		innerRadius = 0.3 * radius;

	var pie = d3.layout.pie()
		.sort(null)
		.value(function(d) { return d.width; });


		var arc = d3.svg.arc()
		  .innerRadius(innerRadius)
		  .outerRadius(function (d) { 
			return (radius - innerRadius) * (d.data.score / 100.0) + innerRadius; 
		  });

		var outlineArc = d3.svg.arc()
				.innerRadius(innerRadius)
				.outerRadius(radius);


  var path = party_performance_trend_svg.selectAll(".solidArc")
      .data(pie(winning_data_count))
    .enter().append("path")
      .attr("fill", function(d) { return color_map[d.data.key]; })
      .attr("class", "solidArc")
      .attr("stroke", function(d) { return d3.rgb(color_map[d.data.key]).darker(); })
      .attr("d", arc)
	  .attr("data-title",function(d) { return  'party : '+d.data.key+' <br/> contested seats : '+d.data.contest+' <br/> seats won : '+d.data.values+' <br/> convertion percentage : '+d.data.score ;});

  var outerPath = party_performance_trend_svg.selectAll(".outlineArc")
      .data(pie(winning_data_count))
    .enter().append("path")
      .attr("fill", "none")
      .attr("stroke", "gray")
      .attr("class", "outlineArc")
      .attr("d", outlineArc);  
	
  var max_value = d3.max(winning_data_count, function(d) { return d.values; });
  winning_party = winning_data_count.filter(function(d){return (d.values==max_value)});  
  
  party_performance_trend_svg.append("text")
    .attr("class", "aster-score")
    .attr("dy", ".35em")
    .attr("text-anchor", "middle")
	.style("fill", "rgb(99, 99, 99)")
	.attr("font-size", 22)	// text-align: right
    .text(winning_party[0]['key']);
	
      $("path").tooltip({container: '.party_performance_trend_svg', html: true, placement:'top'});
	  
        });
  
