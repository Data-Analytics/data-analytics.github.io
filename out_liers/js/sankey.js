d3.sankey=function(){function g(){e.forEach(function(a){a.sourceLinks=[],a.targetLinks=[]}),f.forEach(function(a){var b=a.source,c=a.target;"number"==typeof b&&(b=a.source=e[a.source]),"number"==typeof c&&(c=a.target=e[a.target]),b.sourceLinks.push(a),c.targetLinks.push(a)})}function h(){e.forEach(function(a){a.value=Math.max(d3.sum(a.sourceLinks,p),d3.sum(a.targetLinks,p))})}function i(){for(var c,a=e,d=0;a.length;)c=[],a.forEach(function(a){a.x=d,a.dx=b,a.sourceLinks.forEach(function(a){c.push(a.target)})}),a=c,++d;k(d),l((width-b)/(d-1))}function k(a){e.forEach(function(b){b.sourceLinks.length||(b.x=a-1)})}function l(a){e.forEach(function(b){b.x*=a})}function m(a){function h(){var a=d3.min(b,function(a){return(d[1]-(a.length-1)*c)/d3.sum(a,p)});b.forEach(function(b){b.forEach(function(b,c){b.y=c,b.dy=b.value*a})}),f.forEach(function(b){b.dy=b.value*a})}function i(a){function c(a){return o(a.source)*a.value}b.forEach(function(b,d){b.forEach(function(b){if(b.targetLinks.length){var d=d3.sum(b.targetLinks,c)/d3.sum(b.targetLinks,p);b.y+=(d-o(b))*a}})})}function j(a){function c(a){return o(a.target)*a.value}b.slice().reverse().forEach(function(b){b.forEach(function(b){if(b.sourceLinks.length){var d=d3.sum(b.sourceLinks,c)/d3.sum(b.sourceLinks,p);b.y+=(d-o(b))*a}})})}function k(){b.forEach(function(a){var b,e,h,f=0,g=a.length;for(a.sort(l),h=0;h<g;++h)b=a[h],e=f-b.y,e>0&&(b.y+=e),f=b.y+b.dy+c;if(e=f-c-d[1],e>0)for(f=b.y-=e,h=g-2;h>=0;--h)b=a[h],e=b.y+b.dy+c-f,e>0&&(b.y-=e),f=b.y})}function l(a,b){return a.y-b.y}var b=d3.nest().key(function(a){return a.x}).sortKeys(d3.ascending).entries(e).map(function(a){return a.values});h(),k();for(var g=1;a>0;--a)j(g*=.99),k(),i(g),k()}function n(){function a(a,b){return a.source.y-b.source.y}function b(a,b){return a.target.y-b.target.y}e.forEach(function(c){c.sourceLinks.sort(b),c.targetLinks.sort(a)}),e.forEach(function(a){var b=0,c=0;a.sourceLinks.forEach(function(a){a.sy=b,b+=a.dy}),a.targetLinks.forEach(function(a){a.ty=c,c+=a.dy})})}function o(a){return a.y+a.dy/2}function p(a){return a.value}var a={},b=24,c=8,d=[1,1],e=[],f=[];return a.nodeWidth=function(c){return arguments.length?(b=+c,a):b},a.nodePadding=function(b){return arguments.length?(c=+b,a):c},a.nodes=function(b){return arguments.length?(e=b,a):e},a.links=function(b){return arguments.length?(f=b,a):f},a.size=function(b){return arguments.length?(d=b,a):d},a.layout=function(b){return g(),h(),i(),m(b),n(),a},a.relayout=function(){return n(),a},a.link=function(){function b(b){var c=b.source.x+b.source.dx,d=b.target.x,e=d3.interpolateNumber(c,d),f=e(a),g=e(1-a),h=b.source.y+b.sy+b.dy/2,i=b.target.y+b.ty+b.dy/2;return"M"+c+","+h+"C"+f+","+h+" "+g+","+i+" "+d+","+i}var a=.5;return b.curvature=function(c){return arguments.length?(a=+c,b):a},b},a};