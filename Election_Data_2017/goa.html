<!DOCTYPE html>
<!------------------------------------------------------------
 Name:        data-analytics.github.io
 Purpose:     Data visualisation and analytics examples 
 Author:      sushanth
 Created:     3-10-2017
 Modified:    3-11-2017
 Copyright:  (c) sushanth 2017
 Licence:     protected(not suppose to se it directly)
-------------------------------------------------------------->
<html>
  <head>
 <meta http-equiv="X-UA-COMPATIBLE" content="IE=EmulateIE9">
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Sushanth">
  <meta name="description" content="This Interactive Map Tells You Everything You Need to Know About the 2017 Punjab Election,Punjab Assembly Election Results 2017 'A visual guide to the check out the history of Punjab Assembly elections, from 2012 until 2017', Which of the Dravidian duos might get the stronghold in Punjab? What will be the pre-poll alliances? For the state January is a crucial month to predict next political face.">
  <meta name="news_keywords" content="Punjab polls, Punjab assembly polls, jayalalithaa, chennai floods, Punjab elections, Punjab assembly elections, chennai news, Punjab news, india news">
  <meta name="keywords" content="Punjab polls, Punjab assembly polls, jayalalithaa, chennai floods, Punjab elections, Punjab assembly elections, chennai news, Punjab news, india news">
  <link href="css/bootstrap.css" rel="stylesheet">    
  <link href="css/basic.css" rel="stylesheet">
  <link href="css/feature.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" media="screen" href="http://fortawesome.github.io/Font-Awesome/assets/font-awesome/css/font-awesome.css">
  <link rel="stylesheet" type="text/css" media="screen" href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css">
  <link href="css/custom-styles.css" rel="stylesheet">
  <link href="css/jquery-ui.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" media="screen" href="/./css/multiple-select.css">
  <link href="//cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css" rel="stylesheet" />
  <link rel="shortcut icon" href="/./images/logo.png">
  <script type="text/javascript" src="js/jquery.min.js"></script>  
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script type="text/javascript" src="js/sankey.js"></script>
  <script type="text/javascript" src="/./javascripts/google-analyitcs.js"></script> 
  <script type="text/javascript" src="/./javascripts/angular.min.js"></script>  
  <script type="text/javascript" src="js/bootstrap.min.js"></script>  
  <script type="text/javascript" src="js/underscore-min.js"></script>
  <script type="text/javascript" src="/./javascripts/jquery.multiple.select.js"></script>  
  <script type="text/javascript" src="js/jquery-ui-1.10.3.min.js" ></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.10/js/jquery.dataTables.min.js"></script> 
  <meta property="og:title"  content="ASSEMBLY ELECTIONS 2012 - 2017 (Punjab)" /> 
  <meta property="og:url"   content="http://data-analytics.github.io/Election_Data/punjab.html" /> 
  <meta property="og:description" content="Punjab Assembly Election Results 2017 'A visual guide to the check out the history of Punjab Assembly elections, from 2012 until 2017'" /> 
  <html itemscope itemtype="http://schema.org/Blog">
  <meta itemprop="description" content="Punjab Assembly Election Results 2017 'A visual guide to the check out the history of Punjab Assembly elections, from 2012 until 2017'">
  <meta itemprop="name" content="ASSEMBLY ELECTIONS 2012 - 2017 (Punjab)">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.20/topojson.min.js"></script>
  <title>Assembly Elections 2012 - 2017 (Punjab)</title>  
    <style>

      body {
        margin: 0;
        font-family: "Helvetica Neue", sans-serif;
      }

      .subunit {
        stroke: #333;
        stroke-width: 1px;
      }
      .subunit-boundary {
        fill: none;
        stroke: #3a403d;
      }

      .place-label {
        font-size: .7em;
        text-shadow: 0px 0px 2px #fff;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid header-style">
        <div class="container">
            <div class="row">
                <div class="col-md-12 header-logo">
                    <p class="heading-part"><a class="fa fa-home fa-2" id="home" href="/./"></a>Punjab Assembly Election Results 2017, 'A visual guide to the check out the history of Punjab Assembly elections from 2012 until 2017</p>
                    <p class="synopsis">This interactive map will bring you minute-by-minute results, from the national standings down to individual candidates and constituencies.Our Analytics And Advanced Visualization helps to bring in-depth Analysis.</p>
                    <p class="synopsis">It aims to make the past 2 Assembly elections in Punjab  more easily understandable for the lay audience, allowing them to explore and discover insights.</p>
                <p align="center"><span class='st_facebook_hcount' displayText='Facebook'></span>
                <span class='st_twitter_hcount' displayText='Tweet'></span>
                <span class='st_linkedin_hcount' displayText='LinkedIn'></span>
                <span class='st_googleplus_hcount' displayText='Google'></span>
                <span class='st_email_hcount' displayText='Email'></span></p>
                </div>
            </div>
        </div>
    </div>

    <div id="overall_view">
    <div class="container-fluid">
        <div class="container">
            <div class="row">
            <div class="col-md-12 panel panel-default">
            <div class="row">
                <div class="col-md-12 panel-heading1">
                    <h2>Assembly Election Results <i class="year_tag"></i> Party Standings</h2>
                </div>    
           </div>
           <div class="row">           
                <div class=" col-md-12 panel-body">
                    <div class="dropdown header_year">
                        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Select Year</button>
                            <ul class="dropdown-menu" role="menu">
                                <li data-year="2017" id="2017_flow"><a href="?year=2017#overall_view">2017 results</a></li>
                                <li data-year="2012" id="2012_flow"><a href="?year=2012#overall_view">2012 results</a></li>
                            </ul>
                      </div><br/><br/>
                    <div class="row">
                       <svg data-height="0.54" viewBox="0 0 1200 30" style="width: 100%;" xmlns="http://www.w3.org/2000/svg" xlink:xlink="http://www.w3.org/1999/xlink" version="1.1">
                          <g class="headers" transform="translate(80,0)">
                              <rect class="party-legend" data-party="DMK" data-highlight="[data-party=DMK]" data-toggle="highlight" x="0.0" width="67.1428571429" height="20" fill="#c0392b"></rect>
                              <text x="33.5714285714" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">DMK</text>
                              <rect class="party-legend" data-party="ADMK" data-highlight="[data-party=ADMK]" data-toggle="highlight" x="67.1428571429" width="67.1428571429" height="20" fill="#b2d33c"></rect>
                              <text x="100.714285714" y="10.0" text-anchor="middle" dy=".35em" fill="#000">ADMK</text>
                              <rect class="party-legend" data-party="INC" data-highlight="[data-party=INC]" data-toggle="highlight" x="134.285714286" width="67.1428571429" height="20" fill="#3498DB"></rect>
                              <text x="167.857142857" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">INC</text>
                              <rect class="party-legend" data-party="CPM" data-highlight="[data-party=CPM]" data-toggle="highlight" x="201.428571429" width="67.1428571429" height="20" fill="#ff5757"></rect>
                              <text x="235.0" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">CPM</text>
                              <rect class="party-legend" data-party="TMC" data-highlight="[data-party=TMC]" data-toggle="highlight" x="268.571428571" width="67.1428571429" height="20" fill="#4747ff"></rect>
                              <text x="302.142857143" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">TMC</text>
                              <rect class="party-legend" data-party="OTH" data-highlight="[data-party=OTH]" data-toggle="highlight" x="335.714285714" width="67.1428571429" height="20" fill="#222"></rect>
                              <text x="369.285714286" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">Others</text>
                              <rect class="party-legend" data-party="CPI" data-highlight="[data-party=CPI]" data-toggle="highlight" x="402.857142857" width="67.1428571429" height="20" fill="#ff5757"></rect>
                              <text x="436.428571429" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">CPI</text>
                              <rect class="party-legend" data-party="PMK" data-highlight="[data-party=PMK]" data-toggle="highlight" x="470.0" width="67.1428571429" height="20" fill="#d35400"></rect>
                              <text x="503.571428571" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">PMK</text>
                              <rect class="party-legend" data-party="DMDK" data-highlight="[data-party=DMDK]" data-toggle="highlight" x="537.142857143" width="67.1428571429" height="20" fill="#f1c40f"></rect>
                              <text x="570.714285714" y="10.0" text-anchor="middle" dy=".35em" fill="#000">DMDK</text>
                              <rect class="party-legend" data-party="NCO" data-highlight="[data-party=NCO]" data-toggle="highlight" x="604.285714286" width="67.1428571429" height="20" fill="#1f77b4"></rect>
                              <text x="637.857142857" y="10.0" text-anchor="middle" dy=".35em" fill="#000">NCO</text>
                              <rect class="party-legend" data-party="JNP" data-highlight="[data-party=JNP]" data-toggle="highlight" x="671.428571429" width="67.1428571429" height="20" fill="#9A9E56"></rect>
                              <text x="705.0" y="10.0" text-anchor="middle" dy=".35em" fill="#000">JNP</text>
                              <rect class="party-legend" data-party="MDMK" data-highlight="[data-party=MDMK]" data-toggle="highlight" x="738.571428571" width="67.1428571429" height="20" fill="#9b59b6"></rect>
                              <text x="772.142857143" y="10.0" text-anchor="middle" dy=".35em" fill="#000">MDMK</text>
                              <rect class="party-legend" data-party="IND" data-highlight="[data-party=IND]" data-toggle="highlight" x="805.714285714" width="67.1428571429" height="20" fill="#bdc3c7"></rect>
                              <text x="839.285714286" y="10.0" text-anchor="middle" dy=".35em" fill="#000">IND</text>
                              <rect class="party-legend" data-party="BJP" data-highlight="[data-party=BJP]" data-toggle="highlight" x="872.857142857" width="67.1428571429" height="20" fill="#ff7f0e"></rect>
                              <text x="906.428571429" y="10.0" text-anchor="middle" dy=".35em" fill="#000">BJP</text>
                              </g>                      
                            </svg>
                    <div class="col-md-2"></div> 
                    <div class="col-md-8"> 
                     <div class="overall_view_report">                     
                     </div>
                    </div>
                    <div class="col-md-2"></div> 
                    </div>


                </div>
            </div>
            </div>
            </div>
    </div>
    </div>
    </div>
    
    <div id="individual_hold" class="map_hider">
    <div class="container-fluid">
    <div class="container">
            <div class="row">
            <div class="col-md-12 panel panel-default">
            <div class="row">
                <div class="col-md-12 panel-heading1">
                    <h2>Assembly Elections View By Individual Elections <i class="extra_year_tag"></i></h2>
                </div>    
            </div>
            <div class="row">           
                <div class=" col-md-12 panel-body">
            
                    <div class="dropdown header_year">
                        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Select Year</button>
                            <ul class="dropdown-menu" role="menu">
                                <li data-year="2017" id="extra_2017"><a href="?extra_year=2017#individual_hold">2017 results</a></li>
                                <li data-year="2012" id="extra_2012"><a href="?extra_year=2012#individual_hold">2012 results</a></li>
                            </ul>
                    </div>
                      
                    <p class="form-inline header_form" >
                        <label align="left" >Search:</label>
                        <input type="text" class="geo_search" placeholder="eg: ludhiana ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <label value="year">based on 2012 : </label>
                        <select multiple="multiple" id="year_2012" class="select_year"></select>&nbsp;&nbsp;
                        <label value="year">based on 2017 : </label>
                        <select multiple="multiple" id="year_2017" class="select_year"></select>
                        <input type="button" value="submit" class="party_filter"></input> 
                    </p>
                       
                     <div class="chart">  
                        <svg data-height="0.54" viewBox="0 0 1200 25" style="width: 100%;" xmlns="http://www.w3.org/2000/svg" xlink:xlink="http://www.w3.org/1999/xlink" version="1.1">
                            <g class="headers" transform="translate(80,0)">
                              <rect class="party-legend" data-party="DMK" data-highlight="[data-party=DMK]" data-toggle="highlight" x="0.0" width="67.1428571429" height="20" fill="#c0392b"></rect>
                              <text class="party-legend" data-party="DMK" data-highlight="[data-party=DMK]" data-toggle="highlight" x="33.5714285714" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">DMK</text>
                              <rect class="party-legend" data-party="ADMK" data-highlight="[data-party=ADMK]" data-toggle="highlight" x="67.1428571429" width="67.1428571429" height="20" fill="#b2d33c"></rect>
                              <text class="party-legend" data-party="ADMK" data-highlight="[data-party=ADMK]" data-toggle="highlight" x="100.714285714" y="10.0" text-anchor="middle" dy=".35em" fill="#000">ADMK</text>
                              <rect class="party-legend" data-party="INC" data-highlight="[data-party=INC]" data-toggle="highlight" x="134.285714286" width="67.1428571429" height="20" fill="#3498DB"></rect>
                              <text class="party-legend" data-party="INC" data-highlight="[data-party=INC]" data-toggle="highlight" x="167.857142857" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">INC</text>
                              <rect class="party-legend" data-party="CPM" data-highlight="[data-party=CPM]" data-toggle="highlight" x="201.428571429" width="67.1428571429" height="20" fill="#ff5757"></rect>
                              <text class="party-legend" data-party="CPM" data-highlight="[data-party=CPM]" data-toggle="highlight" x="235.0" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">CPM</text>
                              <rect class="party-legend" data-party="TMC" data-highlight="[data-party=TMC]" data-toggle="highlight" x="268.571428571" width="67.1428571429" height="20" fill="#4747ff"></rect>
                              <text class="party-legend" data-party="TMC" data-highlight="[data-party=TMC]" data-toggle="highlight" x="302.142857143" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">TMC</text>
                              <rect class="party-legend" data-party="OTH" data-highlight="[data-party=OTH]" data-toggle="highlight" x="335.714285714" width="67.1428571429" height="20" fill="#222"></rect>
                              <text class="party-legend" data-party="OTH" data-highlight="[data-party=OTH]" data-toggle="highlight" x="369.285714286" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">Others</text>
                              <rect class="party-legend" data-party="CPI" data-highlight="[data-party=CPI]" data-toggle="highlight" x="402.857142857" width="67.1428571429" height="20" fill="#ff5757"></rect>
                              <text class="party-legend" data-party="CPI" data-highlight="[data-party=CPI]" data-toggle="highlight" x="436.428571429" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">CPI</text>
                              <rect class="party-legend" data-party="PMK" data-highlight="[data-party=PMK]" data-toggle="highlight" x="470.0" width="67.1428571429" height="20" fill="#d35400"></rect>
                              <text class="party-legend" data-party="PMK" data-highlight="[data-party=PMK]" data-toggle="highlight" x="503.571428571" y="10.0" text-anchor="middle" dy=".35em" fill="#fff">PMK</text>
                              <rect class="party-legend" data-party="DMDK" data-highlight="[data-party=DMDK]" data-toggle="highlight" x="537.142857143" width="67.1428571429" height="20" fill="#f1c40f"></rect>
                              <text class="party-legend" data-party="DMDK" data-highlight="[data-party=DMDK]" data-toggle="highlight" x="570.714285714" y="10.0" text-anchor="middle" dy=".35em" fill="#000">DMDK</text>
                              <rect class="party-legend" data-party="NCO" data-highlight="[data-party=NCO]" data-toggle="highlight" x="604.285714286" width="67.1428571429" height="20" fill="#1f77b4"></rect>
                              <text class="party-legend" data-party="NCO" data-highlight="[data-party=NCO]" data-toggle="highlight" x="637.857142857" y="10.0" text-anchor="middle" dy=".35em" fill="#000">NCO</text>
                              <rect class="party-legend" data-party="JNP" data-highlight="[data-party=JNP]" data-toggle="highlight" x="671.428571429" width="67.1428571429" height="20" fill="#9A9E56"></rect>
                              <text class="party-legend" data-party="JNP" data-highlight="[data-party=JNP]" data-toggle="highlight" x="705.0" y="10.0" text-anchor="middle" dy=".35em" fill="#000">JNP</text>
                              <rect class="party-legend" data-party="MDMK" data-highlight="[data-party=MDMK]" data-toggle="highlight" x="738.571428571" width="67.1428571429" height="20" fill="#9b59b6"></rect>
                              <text class="party-legend" data-party="MDMK" data-highlight="[data-party=MDMK]" data-toggle="highlight" x="772.142857143" y="10.0" text-anchor="middle" dy=".35em" fill="#000">MDMK</text>
                              <rect class="party-legend" data-party="IND" data-highlight="[data-party=IND]" data-toggle="highlight" x="805.714285714" width="67.1428571429" height="20" fill="#bdc3c7"></rect>
                              <text class="party-legend" data-party="IND" data-highlight="[data-party=IND]" data-toggle="highlight" x="839.285714286" y="10.0" text-anchor="middle" dy=".35em" fill="#000">IND</text>
                              <rect class="party-legend" data-party="BJP" data-highlight="[data-party=BJP]" data-toggle="highlight" x="872.857142857" width="67.1428571429" height="20" fill="#ff7f0e"></rect>
                              <text x="906.428571429" y="10.0" text-anchor="middle" dy=".35em" fill="#000">BJP</text>
                            </g>
                        </svg>
                        <div class="geo_map">
                        </div>
                        </div>
                     </div>
                </div>
            </div>
            </div>
            </div>
    </div>
    </div>
    <script>

color_map = {"ADK(JL)":"#363636","ADK(JR)":"#363636","ADMK":"#b2d33c","AIFB":"#FFAD01","AINRC":"#B78332","AITC":"#4A9F88","AKD":"#363636","BAC":"#A99888","BBC":"#363636","BJP":"#ff7f0e","BJS":"#363636","BLD":"#363636","C(S)":"#363636","CMPKSC":"#363636","CON":"#ff7f0e","CON(S)":"#363636","CPI":"#F27A67","CPI(M)":"#363636","CPM":"#ff5757","CPM(K)":"#363636","DIC":"#363636","DMDK":"#f1c40f","DMK":"#c0392b","DSP(P)":"#363636","DSP(PC)":"#363636","FB":"#363636","FB(S)":"#363636","FBL":"#014BC6","FBL(MG)":"#363636","FBL(RG)":"#363636","FBM":"#363636","GKC":"#363636","GL":"#363636","GNLF":"#363636","GOJAM":"#363636","HMS":"#363636","IC(S)":"#363636","ICS":"#363636","ICS(SCS)":"#363636","IGL":"#363636","IML":"#363636","INC":"#3498DB","INC(U)":"#4A9F88","IND":"#bdc3c7","INL":"#363636","ISP":"#363636","IUML":"#014BC6","JD":"#363636","JD(S)":"#363636","JKP":"#363636","JKP(N)":"#363636","JNP":"#9A9E56","JP":"#363636","JPSS":"#363636","KC":"#363636","KCJ":"#363636","KCM":"#363636","KCP":"#363636","KCS":"#363636","KEC":"#FFAD01","KEC(B)":"#363636","KEC(J)":"#363636","KEC(M)":"#FFAD01","KMPP":"#363636","KRSP":"#363636","KSP":"#363636","LKD":"#363636","LSS":"#363636","MAG":"#981D97","MFB":"#363636","ML":"#363636","MLO":"#363636","MNMK":"#363636","GVP":"#014BC6","NA":"#363636","NCO":"#1F77B4","NCP":"#363636","NDF":"#363636","NDP":"#363636","NSC":"#363637","Others":"#363636","PF":"#363636","PMC":"#363636","PMK":"#d35400","PML":"#363636","PSP":"#FFD380","PT":"#363636","RCI":"#363636","RCPI(RB)":"#363636","RJD":"#363636","RSP":"#F8F907","RSPK(B)":"#363636","SBP":"#363636","SJD":"#363636","SOP":"#363636","SP":"#363636","SSP":"#1F77B4","SUC":"#363636","SUCI":"#363636","SWA":"#363636","TMC":"#4747ff","TMC(M)":"#4747ff","TMK":"#363636","VCK":"#363636","WBSP":"#363636","WPI":"#363636","FPM":"#363636","KNA":"#363636","MHU":"#363636","MPP":"#363636","MRP":"#FAEA75","MSCP":"#dbabab","NPP":"#363636","DRPP":"#363636","#N/A":"#363636","SAP":"#363636","LJP":"#363636","NPF":"#363636","JD(U)":"#363636"};

      d3.csv("Goa.csv", function(goa_data) { 
    
    year_data_set_2012 = map_data.filter(function(d){return (d.YEAR==2012 & d['#']==1)  })
    year_data_set_2017 = map_data.filter(function(d){return (d.YEAR==2007 & d['#']==1)  })
        
    party_2012 = _.uniq(year_data_set_2012, function(item, key, a) { return item['PARTY']; });
    party_2017 = _.uniq(year_data_set_2017, function(item, key, a) { return item['PARTY']; });

    var select_box = d3.select('#year_2012')
                .selectAll("option")
                    .data(party_2012.filter(function(d) { return d['PARTY']!='' })) 
                    .enter().append("option")
                    .attr("value", function (d) { return d['PARTY']; })
                    .attr("class","name")
                    .attr("selected","")
                    .text(function (d) { return d['PARTY']; });

      var select_box = d3.select('#year_2017')     
                .selectAll("option")
                    .data(party_2017.filter(function(d) { return d['PARTY']!='' }))
                    .enter().append("option")
                    .attr("value", function (d) { return d['PARTY']; })
                    .attr("class","name")
                    .attr("selected","")
                    .text(function (d) { return d['PARTY']; });
      $(".select_year").multipleSelect({ placeholder: "Here is the placeholder" });

      var year_2017 = [];
      $('#year_2017 :selected').each(function(i, selected){
          year_2017[i] = $(selected).val();
      });

      var year_2012 = [];
      $('#year_2012 :selected').each(function(i, selected){
            year_2012[i] = $(selected).val();
      });

      var year_data_sets = d3.nest()
              .key(function(d) { return d['PARTY']; })
              .rollup(function(v) { return v.length;  })
              .entries(year_data_set_2012);
   
      year_data_sets.sort(function(a, b) { return b.value - a.value; })
      
      heading_colors = []
       year_data_sets.forEach(function(o) {
        heading_colors.push(color_map[o.key])
       })
  
        max_seats = d3.max(year_data_sets, function(d) { return d.value; }); 

        lowresult_data  = d3.select('.overall_view_report')
                             .selectAll('div')
                            .data([year_data_sets])
                            .enter()
                            .append("div")
                            .append("table")
                            .attr("class","table table-condensed party-summary")

              lowresult_data.append('thead')
                            .selectAll("tr")
                            .data([['Party','Seats','Seat Share']]).enter()
                            .append("tr")
                            .selectAll("th")
                                .data(function(d,l) { return d }).enter()
                                .append('th')
                                .style("max-width",'10px')
                                .style("font-size",'15px')
                                .append("font")
                                .attr("color","#636363")
                                .text(function(o,i) { return o });

                        lowresult_data.append('tbody')
                                .selectAll("tr")
                                .data(function(o) { return o }).enter()
                                .append("tr")
                                .selectAll("td")
                                    .data(function(d,l) { return [d.key,d.value,l+':'+(d.value*100/max_seats).toFixed(2)] }).enter()
                                    .append('td')
                                    .attr('class',function(d) { return d+'s'})
                                    .style("max-width",'10px')
                                    .style("font-size",'15px')
                                    .text(function(o,i) { return i<2? o:'' })
                                    .append('div')
                                    .attr('class',function(d,i) { return i<2? '':'progress'; })
                                    .append('div')
                                    .attr('class','progress-bar progress-bar-striped')
                                    .attr('role','progressbar')
                                    .attr('aria-valuenow','70')
                                    .attr('aria-valuemin','0')
                                    .attr('aria-valuemax','100')
                                    .style('background-color',function(d,i) { return i<2? '':heading_colors[parseInt(d.split(':')[0])]; })
                                    .style('width',function(d,i) { return i<2? '0%':d.split(':')[1]+'%'; });
                                   
            d3.selectAll('.removed_data').remove();
    
         map_data.forEach(function(o) {
          o.polled_votes = parseInt(o.polled_votes);
          o.votes = parseInt(o.VOTES);
          o.YEAR = parseInt(o.YEAR);
          o.rank = parseInt(o['#']);
          o.ac = parseInt(o.AC_NO);
          o.vote_percent = parseFloat(o.vote_percent);
          });
       
      map_data = map_data.filter(function(d){return (d.YEAR==2012) })
      map_data = map_data.filter(function(d){return (d.rank==1) })

      var width = window.innerWidth, height = window.innerHeight;

      var projection = d3.geoMercator();

      var path = d3.geoPath()
          .projection(projection)
          .pointRadius(2);

      var svg = d3.select(".geo_map").append("svg")
            .attr("width", "100%")
            .attr("data-height","0.54")
            .attr("viewBox","0 0 "+(width*1.2)+" "+(height))
            .attr("xmlns", 'http://www.w3.org/2000/svg')
            .attr("xlink", 'http://www.w3.org/1999/xlink')
            .attr("version", '1.1');

      var g = svg.append("g")
                  .attr("transform", "translate("+(width*.1)+",0)");
    
      d3.json("goatopo.json", function(error, data) {
        if (error) throw error;

        var boundary = centerZoom(data);
        drawSubUnits(data);
        drawOuterBoundary(data, boundary);

      });

      // This function "centers" and "zooms" a map by setting its projection's scale and translate according to its outer boundary
      // It also returns the boundary itself in case you want to draw it to the map
      function centerZoom(data){
        var o = topojson.mesh(data, data.objects.polygons, function(a, b) { return a === b; });

        projection
            .scale(1)
            .translate([0, 0]);

        var b = path.bounds(o),
            s = 1 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height),
            t = [(width - s * (b[1][0] + b[0][0])) / 2, (height - s * (b[1][1] + b[0][1])) / 2];

        projection
            .scale(s)
            .translate(t);

        return o;
      }

      function addThousandsSeparator(t){
          var a=t;if(parseFloat(t)){t=new String(t);var e=t.split(".");e[0]=e[0].split("").reverse().join("").replace(/(\d{3})(?!$)/g,"$1,").split("").reverse().join(""),a=e.join(".")}return a}
    
      function drawOuterBoundary(data, boundary){
        g.append("path")
            .datum(boundary)
            .attr("d", path)
            .attr("class", "subunit-boundary");
      }

      function drawPlaces(data){
        g.append("path")
            .datum(topojson.feature(data, data.objects.places))
            .attr("d", path)
            .attr("class", "place");

        g.selectAll(".place-label")
            .data(topojson.feature(data, data.objects.places).features)
          .enter().append("text")
            .attr("class", "place-label")
            .attr("transform", function(d) { return "translate(" + projection(d.geometry.coordinates) + ")"; })
            .attr("dy", ".35em")
            .attr("x", 6)
            .style("text-anchor", "start")
            .text(function(d) { return d.properties.name; });
      }
      
      constituency_list =[]
      function drawSubUnits(data){
        mapper_data_view = topojson.feature(data, data.objects.polygons).features

        mapper_data_view.forEach(function(o) {
            map_data.forEach(function(g){
              if (o.properties.ac == g.ac){
                constituency_list.push(o.properties.ac_name);
                o.result = g
              }
            });
          });

        g.selectAll(".subunit")
            .data(mapper_data_view)
          .enter().append("path")
            .attr("class", "subunit")
            .attr("data-title", function (d){ return 'Constituency : '+d.properties.ac_name+'</br> Party : '+d.result.PARTY+'<br/> votes : '+addThousandsSeparator(d.result.votes)+'<br/> Vote percent: '+d.result.vote_percent.toFixed(2)+'% <br/> year: '+d.result.YEAR })
            .attr("sub_link", function (d){ return d.properties.ac_name })
            .attr("fill", function(d) { return d.result!=undefined? color_map[d.result.PARTY] : '#00ff00'  })
            //.attr("fill", function (d){ console.log(d); return d.properties.ac_name })
            .attr("d", path);

      $("path").tooltip({container: '.geo_map', html: true, placement:'top'});
      
var lastsearch = '';
    var $box = {};
    
    function add_search(search, chart) {
      var $chart = $(chart);
      $(search).on('keypress, change, keyup', function() {
        var search = $(this).val();
        if (lastsearch != search) {
          lastsearch = search;
          var re = new RegExp( "^" + search, "i" );
          $('path', $chart).each(function(){
              $(this).css('fill-opacity', re.test($(this).attr("sub_link")) ? '1.0': '0.1');
          });
        }
      });
    }

   add_search('.geo_search', '.geo_map');
   var Industry = constituency_list;
    
    $( ".geo_search" ).autocomplete({
    source: function(req, responseFn) {
        var re = $.ui.autocomplete.escapeRegex(req.term);
        var matcher = new RegExp( "^" + re, "i" );
        var a = $.grep( Industry, function(item,index){
            return matcher.test(item);
        });
        responseFn( a );
    }
    });
    
      }

      });

    </script>

  </body>
</html>
